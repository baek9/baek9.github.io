<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Finding the DRM device node corresponding to the graphics card | code(evening); Development Diary</title><meta name=keywords content="DRM,DRI,udev"><meta name=description content="#DRM #DRI #udev
DRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.
In general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card."><meta name=author content="baek9"><link rel=canonical href=https://baek9.github.io/en/2018/01/finding-the-drm-device-node-corresponding-to-the-graphics-card/><meta name=google-site-verification content="jxplsfLcADRts9fVC-PBsYD4NFNGHEMo08_Lj3HzSts"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.1b2afdf7fcaa8622a5c1cc704d5ca2da92c173ba5ed24382df9c72b6ca594315.css integrity="sha256-Gyr99/yqhiKlwcxwTVyi2pLBc7pe0kOC35xytspZQxU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://baek9.github.io/logo_squared.png><link rel=icon type=image/png sizes=16x16 href=https://baek9.github.io/logo_squared.png><link rel=icon type=image/png sizes=32x32 href=https://baek9.github.io/logo_squared.png><link rel=apple-touch-icon href=https://baek9.github.io/logo_squared.png><link rel=mask-icon href=https://baek9.github.io/logo_squared.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://baek9.github.io/2018/01/%EA%B7%B8%EB%9E%98%ED%94%BD-%EC%B9%B4%EB%93%9C%EC%97%90-%EB%8C%80%EC%9D%91%EB%90%98%EB%8A%94-drm-%EB%94%94%EB%B0%94%EC%9D%B4%EC%8A%A4-%EB%85%B8%EB%93%9C-%EC%B0%BE%EA%B8%B0/><link rel=alternate hreflang=en href=https://baek9.github.io/en/2018/01/finding-the-drm-device-node-corresponding-to-the-graphics-card/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link href=//cdn.jsdelivr.net/gh/wan2land/d2coding/d2coding-full.css rel=stylesheet><link href=//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css rel=stylesheet type=text/css><link href=https://hangeul.pstatic.net/hangeul_static/css/nanum-square.css rel=stylesheet><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-108486276-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Finding the DRM device node corresponding to the graphics card"><meta property="og:description" content="#DRM #DRI #udev
DRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.
In general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card."><meta property="og:type" content="article"><meta property="og:url" content="https://baek9.github.io/en/2018/01/finding-the-drm-device-node-corresponding-to-the-graphics-card/"><meta property="og:image" content="https://baek9.github.io/logo_extended.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-01-14T22:00:00+00:00"><meta property="article:modified_time" content="2018-01-14T22:00:00+00:00"><meta property="og:site_name" content="code(evening); Development Diary"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://baek9.github.io/logo_extended.png"><meta name=twitter:title content="Finding the DRM device node corresponding to the graphics card"><meta name=twitter:description content="#DRM #DRI #udev
DRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.
In general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://baek9.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"Finding the DRM device node corresponding to the graphics card","item":"https://baek9.github.io/en/2018/01/finding-the-drm-device-node-corresponding-to-the-graphics-card/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Finding the DRM device node corresponding to the graphics card","name":"Finding the DRM device node corresponding to the graphics card","description":"#DRM #DRI #udev\nDRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.\nIn general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card.","keywords":["DRM","DRI","udev"],"articleBody":"#DRM #DRI #udev\nDRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.\nIn general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card. However, unless the graphic card does not support DRI or multiple graphic cards are used. Therefore, there is a need for a way to identify the main graphics card in a more reliable way.\nMethod 1. Using udevadm ¬∂ udevadm prints the device properties corresponding to the device node created by udev. The main graphics card has 1 as the value of the boot_vga attribute. Therefore, if the value of the boot_vga property is 1 among the properties of a specific device node output by udevadm, the corresponding node corresponds to the main graphic card. If you want to see the properties of the graphic card corresponding to ‚Äú/dev/dri/card0‚Äù, enter the following command. ‚Äú/dev/dri/card0‚Äù is a term related to udev and seems to be called DEVNAME.\n$ udevadm info --query=all --name=/dev/dri/card0 P: /devices/pci0000:00/0000:00:0f.0/drm/card0 N: dri/card0 E: DEVNAME=/dev/dri/card0 E: DEVPATH=/devices/pci0000:00/0000:00:0f.0/drm/card0 E: DEVTYPE=drm_minor E: ID_FOR_SEAT=drm-pci-0000_00_0f_0 E: ID_PATH=pci-0000:00:0f.0 E: ID_PATH_TAG=pci-0000_00_0f_0 E: MAJOR=226 E: MINOR=0 E: SUBSYSTEM=drm E: TAGS=:master-of-seat:uaccessüí∫ E: USEC_INITIALIZED=8444405 udev creates device nodes under ‚Äú/dev‚Äù for hotplug-connected devices. In fact, udev is said to configure ‚Äú/dev‚Äù with device information provided by sysfs. Device information is provided hierarchically under ‚Äú/sys‚Äù, and this path is called DEVPATH in terms of udev. From the above result, it can be seen that the DEVPATH corresponding to the DEVNAME ‚Äú/dev/dri/card0‚Äù is ‚Äú/devices/pci0000:00/0000:00:0f.0/drm/card0‚Äù. Even with DEVPATH, device information can be inquired as shown below.\n$ udevadm info -a -p /sys/devices/pci0000:00/0000:00:0f.0/drm/card0 Udevadm info starts with the device specified by the devpath and then walks up the chain of parent devices. It prints for every device found, all possible attributes in the udev rules key format. A rule to match, can be composed by the attributes of the device and the attributes from one single parent device. looking at device '/devices/pci0000:00/0000:00:0f.0/drm/card0': KERNEL==\"card0\" SUBSYSTEM==\"drm\" DRIVER==\"\" looking at parent device '/devices/pci0000:00/0000:00:0f.0': KERNELS==\"0000:00:0f.0\" SUBSYSTEMS==\"pci\" DRIVERS==\"vmwgfx\" ATTRS{boot_vga}==\"1\" ATTRS{broken_parity_status}==\"0\" ATTRS{class}==\"0x030000\" ATTRS{consistent_dma_mask_bits}==\"32\" ATTRS{d3cold_allowed}==\"0\" ATTRS{device}==\"0x0405\" ATTRS{dma_mask_bits}==\"32\" ATTRS{driver_override}==\"(null)\" ATTRS{enable}==\"1\" ATTRS{irq}==\"16\" ATTRS{local_cpulist}==\"0-1\" ATTRS{local_cpus}==\"00000000,00000000,00000000,00000003\" ATTRS{msi_bus}==\"1\" ATTRS{numa_node}==\"-1\" ATTRS{subsystem_device}==\"0x0405\" ATTRS{subsystem_vendor}==\"0x15ad\" ATTRS{vendor}==\"0x15ad\" looking at parent device '/devices/pci0000:00': KERNELS==\"pci0000:00\" SUBSYSTEMS==\"\" DRIVERS==\"\" Method 2. Method using libudev ¬∂ In C code, you can use libudev to find the device node corresponding to the main graphic card. This is reflected in mutter, the compositor used by weston and GNOME. This section considers the case where more than one graphics card is installed. Before the patch, it was hard-coded in the form of ‚Äúopen(\"/dev/dri/card0\")‚Äù. The patch finds the boot_vga property by traversing the device nodes matching ‚Äúdrm/card[0-9]*‚Äù using udev_enumerate_*() functions. In the end, it obtains a udev_device object (a structure provided by libudev) with the corresponding properties, that is, the main graphic card information. Details of the patch can be found at the link below.\nhttps://lists.freedesktop.org/archives/wayland-devel/2012-October/006033.html - https://mail.gnome.org/archives/commits-list/2015-September/msg01412.html find_primary_gpu(), a function added as a patch, is very intuitive from its name. Below is a part of the call stack that runs from the inside of weston to the corresponding function.\nlibweston/compositor-drm.c : find_primary_gpu - libweston/compositor-drm.c : drm_backend_create - libweston/compositor-drm.c : weston_backend_init(WL_EXPORT) - libweston/compositor.c : weston_load_module(WL_EXPORT) Note, weston_load_module() ¬∂ Two strings ‚Äúname‚Äù and ‚Äúentrypoint‚Äù are input. First, the library located in ‚Äú.libs/[name]‚Äù is dynamically loaded using ‚Äúname‚Äù. ‚Äúname‚Äù refers to the file name of the library to be loaded. weston maps the file name of the library to be loaded in each backend by hard-coding. This is an array of strings called backend_map[] in ‚Äúlibweston/compositor.c‚Äù. ‚Äú[drm|fbdev|headless|rdp|wayland|x11]-backend.so‚Äù exists in the array, and the index for reference to the array uses the enum type ‚Äúweston_compositor_backend‚Äù of ‚Äúlibweston/compositor.h‚Äù. That is, ‚Äúbackend_map[WESTON_BACKEND_DRM]‚Äù is mapped to the string ‚Äúdrm-backend.so‚Äù. This string is passed as ‚Äúname‚Äù, the first argument of the weston_load_mudle() function. The types of backends and strings mapped to each are as follows.\n/// libweston/compositor.h enum weston_compositor_backend { WESTON_BACKEND_DRM, WESTON_BACKEND_FBDEV, WESTON_BACKEND_HEADLESS, WESTON_BACKEND_RDP, WESTON_BACKEND_WAYLAND, WESTON_BACKEND_X11, }; // libweston/compositor.c static const char * const backend_map[] = { [WESTON_BACKEND_DRM] =\t\"drm-backend.so\", [WESTON_BACKEND_FBDEV] =\t\"fbdev-backend.so\", [WESTON_BACKEND_HEADLESS] =\t\"headless-backend.so\", [WESTON_BACKEND_RDP] =\t\"rdp-backend.so\", [WESTON_BACKEND_WAYLAND] =\t\"wayland-backend.so\", [WESTON_BACKEND_X11] =\t\"x11-backend.so\", }; weston_load_module() loads the library located in ‚Äúname‚Äù, the first string received as an argument, with the function dlopen(). The second string received as an argument, ‚Äúentrypoint‚Äù, means the name of a function to be called in the loaded library. In other words, using dlsym, find the address of ‚Äúentrypoint‚Äù, that is, the function weston_backend_init(), and call it. libdl helps you to load the library at runtime and access the symbols of the library. The call stack until reaching weston_load_module() is as follows.\nlibweston/compositor.c : weston_load_module(WL_EXPORT) - libweston/compositor.c : weston_compositor_load_backend(WL_EXPORT) - compositor/main.c : weston_compositor_load_backend() - compositor/main.c : load_backend() - compositor/main.c : main() ","wordCount":"814","inLanguage":"en","datePublished":"2018-01-14T22:00:00Z","dateModified":"2018-01-14T22:00:00Z","author":{"@type":"Person","name":"baek9","url":"https://baek9.github.io/"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://baek9.github.io/en/2018/01/finding-the-drm-device-node-corresponding-to-the-graphics-card/"},"publisher":{"@type":"Organization","name":"code(evening); Development Diary","logo":{"@type":"ImageObject","url":"https://baek9.github.io/logo_squared.png"}}}</script></head><body id=top><style>.button-62{background:linear-gradient(to bottom right,#EF4765,#FF9A5A);border:0;border-radius:12px;cursor:pointer;display:inherit;font-family:-apple-system,system-ui,segoe ui,Roboto,Helvetica,Arial,sans-serif;font-size:16px;font-weight:500;line-height:2.5;outline:transparent;padding:0 1rem;text-align:center;text-decoration:none;transition:box-shadow .2s ease-in-out;user-select:none;-webkit-user-select:none;touch-action:manipulation;white-space:nowrap}.button-62:not([disabled]):focus{box-shadow:0 0 .25rem rgba(0,0,0,.5),-.125rem -.125rem 1rem rgba(239,71,101,.5),.125rem .125rem 1rem rgba(255,154,90,.5)}.button-62:not([disabled]):hover{box-shadow:0 0 .25rem rgba(0,0,0,.5),-.125rem -.125rem 1rem rgba(239,71,101,.5),.125rem .125rem 1rem rgba(255,154,90,.5)}</style><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><div class=social-icons><a href=https://baek9.github.io/en/ accesskey=h title="Development Diary (Alt + H)"><img src=https://baek9.github.io/logo.png style=border-radius:5px;padding:6px;background:#fff alt=logo aria-label=logo height=45>Development Diary</a></div><div class="social-icons logo-switches"><ul id=menu><li><div style=vertical-align:center;line-height:16px><a href=https://linkedin.com/in/thnam target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></li><li><div style=vertical-align:center;line-height:16px><a href=https://twitter.com/thnam_ target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></li><li><div style=vertical-align:center;line-height:16px><a href=https://github.com/baek9 target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></li><li><div style=vertical-align:center;line-height:16px><a href=https://baek9.github.io/index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></li></ul></div></div><ul id=menu><li><a href=https://baek9.github.io/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://baek9.github.io/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://baek9.github.io/en/about_me/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main style=min-height:unset><style>.post-title{margin-bottom:2px;font-size:30px}.post-content h2{font-size:25px}.entry-footer{font-size:10px}</style><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://baek9.github.io/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://baek9.github.io/en/posts/>Posts</a></div><h1 class=post-title>Finding the DRM device node corresponding to the graphics card</h1><div class=post-meta><span title='2018-01-14 22:00:00 +0000 UTC'>January 14, 2018</span>&nbsp;¬∑&nbsp;baek9&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://baek9.github.io/2018/01/%EA%B7%B8%EB%9E%98%ED%94%BD-%EC%B9%B4%EB%93%9C%EC%97%90-%EB%8C%80%EC%9D%91%EB%90%98%EB%8A%94-drm-%EB%94%94%EB%B0%94%EC%9D%B4%EC%8A%A4-%EB%85%B8%EB%93%9C-%EC%B0%BE%EA%B8%B0/>üá∞üá∑</a></li></ul></div></header><style>#figmask{width:100%}#figmask{position:relative}#figmask:after{width:100%;content:'';display:block;position:absolute;top:0;left:0;background:linear-gradient(to top,var(--entry) 0,transparent 5em);height:100%}</style><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#method-1-using-udevadm>Method 1. Using <code>udevadm</code></a></li><li><a href=#method-2-method-using-libudev>Method 2. Method using libudev</a></li><li><a href=#note-weston_load_module>Note, <code>weston_load_module()</code></a></li></ul></nav></div></details></div><style>.highlight{margin-bottom:5.5em;font-family:poppins,sans-serif;font-weight:700;text-decoration:none;background:linear-gradient(to right,#64ffff,#64ffff),linear-gradient(to right,red,#4378ff,#64ffff);background-size:100% 3px,0 3px;background-position:100% 100%,0 100%;background-repeat:no-repeat;transition:background-size 400ms}</style><div class=post-content><p>#DRM #DRI #udev</p><p>DRM (Direct Rendering Manager) refers to a device driver for a graphics card supporting DRI (Direct Rendering Infrastructure). I think DRM and DRI should be sorted out next time. In this note, only the method of finding the DRM device node corresponding to the main graphic card is summarized.</p><p>In general, it is safe to say that /dev/dri/card0 is a device node corresponding to the main graphics card. However, unless the graphic card does not support DRI or multiple graphic cards are used. Therefore, there is a need for a way to identify the main graphics card in a more reliable way.</p><div class=post-entry style=background:unset;border:unset><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8701780565311862"></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-8701780565311862 data-ad-slot=3363952713></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><h2 id=method-1-using-udevadm>Method 1. Using <code>udevadm</code> <a href=#method-1-using-udevadm>¬∂</a><a hidden class=anchor aria-hidden=true href=#method-1-using-udevadm>#</a></h2><p><code>udevadm</code> prints the device properties corresponding to the device node created by <code>udev</code>. The main graphics card has 1 as the value of the <code>boot_vga</code> attribute. Therefore, if the value of the <code>boot_vga</code> property is 1 among the properties of a specific device node output by <code>udevadm</code>, the corresponding node corresponds to the main graphic card. If you want to see the properties of the graphic card corresponding to ‚Äú/dev/dri/card0‚Äù, enter the following command. ‚Äú/dev/dri/card0‚Äù is a term related to <code>udev</code> and seems to be called <code>DEVNAME</code>.</p><pre tabindex=0><code>	$ udevadm info --query=all --name=/dev/dri/card0
	
	P: /devices/pci0000:00/0000:00:0f.0/drm/card0
	N: dri/card0
	E: DEVNAME=/dev/dri/card0
	E: DEVPATH=/devices/pci0000:00/0000:00:0f.0/drm/card0
	E: DEVTYPE=drm_minor
	E: ID_FOR_SEAT=drm-pci-0000_00_0f_0
	E: ID_PATH=pci-0000:00:0f.0
	E: ID_PATH_TAG=pci-0000_00_0f_0
	E: MAJOR=226
	E: MINOR=0
	E: SUBSYSTEM=drm
	E: TAGS=:master-of-seat:uaccessüí∫
	E: USEC_INITIALIZED=8444405
</code></pre><p><code>udev</code> creates device nodes under ‚Äú/dev‚Äù for hotplug-connected devices. In fact, <code>udev</code> is said to configure ‚Äú/dev‚Äù with device information provided by <code>sysfs</code>. Device information is provided hierarchically under ‚Äú/sys‚Äù, and this path is called <code>DEVPATH</code> in terms of <code>udev</code>. From the above result, it can be seen that the <code>DEVPATH</code> corresponding to the <code>DEVNAME</code> ‚Äú/dev/dri/card0‚Äù is ‚Äú/devices/pci0000:00/0000:00:0f.0/drm/card0‚Äù. Even with <code>DEVPATH</code>, device information can be inquired as shown below.</p><pre tabindex=0><code>	$ udevadm info -a -p /sys/devices/pci0000:00/0000:00:0f.0/drm/card0
	
	Udevadm info starts with the device specified by the devpath and then
	walks up the chain of parent devices. It prints for every device
	found, all possible attributes in the udev rules key format.
	A rule to match, can be composed by the attributes of the device
	and the attributes from one single parent device.
	
	  looking at device &#39;/devices/pci0000:00/0000:00:0f.0/drm/card0&#39;:
	    KERNEL==&#34;card0&#34;
	    SUBSYSTEM==&#34;drm&#34;
	    DRIVER==&#34;&#34;
	
	  looking at parent device &#39;/devices/pci0000:00/0000:00:0f.0&#39;:
	    KERNELS==&#34;0000:00:0f.0&#34;
	    SUBSYSTEMS==&#34;pci&#34;
	    DRIVERS==&#34;vmwgfx&#34;
	    ATTRS{boot_vga}==&#34;1&#34;
	    ATTRS{broken_parity_status}==&#34;0&#34;
	    ATTRS{class}==&#34;0x030000&#34;
	    ATTRS{consistent_dma_mask_bits}==&#34;32&#34;
	    ATTRS{d3cold_allowed}==&#34;0&#34;
	    ATTRS{device}==&#34;0x0405&#34;
	    ATTRS{dma_mask_bits}==&#34;32&#34;
	    ATTRS{driver_override}==&#34;(null)&#34;
	    ATTRS{enable}==&#34;1&#34;
	    ATTRS{irq}==&#34;16&#34;
	    ATTRS{local_cpulist}==&#34;0-1&#34;
	    ATTRS{local_cpus}==&#34;00000000,00000000,00000000,00000003&#34;
	    ATTRS{msi_bus}==&#34;1&#34;
	    ATTRS{numa_node}==&#34;-1&#34;
	    ATTRS{subsystem_device}==&#34;0x0405&#34;
	    ATTRS{subsystem_vendor}==&#34;0x15ad&#34;
	    ATTRS{vendor}==&#34;0x15ad&#34;
	
	  looking at parent device &#39;/devices/pci0000:00&#39;:
	    KERNELS==&#34;pci0000:00&#34;
	    SUBSYSTEMS==&#34;&#34;
	    DRIVERS==&#34;&#34;
</code></pre><div class=post-entry style=background:unset;border:unset><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8701780565311862"></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-8701780565311862 data-ad-slot=3363952713></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><h2 id=method-2-method-using-libudev>Method 2. Method using libudev <a href=#method-2-method-using-libudev>¬∂</a><a hidden class=anchor aria-hidden=true href=#method-2-method-using-libudev>#</a></h2><p>In C code, you can use <code>libudev</code> to find the device node corresponding to the main graphic card. This is reflected in <code>mutter</code>, the compositor used by <code>weston</code> and <code>GNOME</code>. This section considers the case where more than one graphics card is installed. Before the patch, it was hard-coded in the form of ‚Äúopen("/dev/dri/card0")‚Äù. The patch finds the <code>boot_vga</code> property by traversing the device nodes matching &ldquo;drm/card[0-9]*&rdquo; using <code>udev_enumerate_*()</code> functions. In the end, it obtains a <code>udev_device</code> object (a structure provided by libudev) with the corresponding properties, that is, the main graphic card information. Details of the patch can be found at the link below.</p><ul><li><a href=https://lists.freedesktop.org/archives/wayland-devel/2012-October/006033.html title=https://lists.freedesktop.org/archives/wayland-devel/2012-October/006033.html target=_blank rel="noreferrer noopener nofollow">https://lists.freedesktop.org/archives/wayland-devel/2012-October/006033.html</a> - <a href=https://mail.gnome.org/archives/commits-list/2015-September/msg01412.html title=https://mail.gnome.org/archives/commits-list/2015-September/msg01412.html target=_blank rel="noreferrer noopener nofollow">https://mail.gnome.org/archives/commits-list/2015-September/msg01412.html</a></li></ul><p><code>find_primary_gpu()</code>, a function added as a patch, is very intuitive from its name. Below is a part of the call stack that runs from the inside of <code>weston</code> to the corresponding function.</p><ul><li>libweston/compositor-drm.c : find_primary_gpu - libweston/compositor-drm.c : drm_backend_create - libweston/compositor-drm.c : weston_backend_init(WL_EXPORT) - libweston/compositor.c : weston_load_module(WL_EXPORT)</li></ul><div class=post-entry style=background:unset;border:unset><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8701780565311862"></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-8701780565311862 data-ad-slot=3363952713></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><h2 id=note-weston_load_module>Note, <code>weston_load_module()</code> <a href=#note-weston_load_module>¬∂</a><a hidden class=anchor aria-hidden=true href=#note-weston_load_module>#</a></h2><p>Two strings ‚Äúname‚Äù and ‚Äúentrypoint‚Äù are input. First, the library located in ‚Äú.libs/[name]‚Äù is dynamically loaded using ‚Äúname‚Äù. ‚Äúname‚Äù refers to the file name of the library to be loaded. <code>weston</code> maps the file name of the library to be loaded in each backend by hard-coding. This is an array of strings called <code>backend_map[]</code> in ‚Äúlibweston/compositor.c‚Äù. &ldquo;[drm|fbdev|headless|rdp|wayland|x11]-backend.so&rdquo; exists in the array, and the index for reference to the array uses the enum type ‚Äúweston_compositor_backend‚Äù of ‚Äúlibweston/compositor.h‚Äù. That is, ‚Äúbackend_map[WESTON_BACKEND_DRM]‚Äù is mapped to the string ‚Äúdrm-backend.so‚Äù. This string is passed as ‚Äúname‚Äù, the first argument of the <code>weston_load_mudle()</code> function. The types of backends and strings mapped to each are as follows.</p><pre tabindex=0><code>/// libweston/compositor.h
enum weston_compositor_backend {
	WESTON_BACKEND_DRM,
	WESTON_BACKEND_FBDEV,
	WESTON_BACKEND_HEADLESS,
	WESTON_BACKEND_RDP,
	WESTON_BACKEND_WAYLAND,
	WESTON_BACKEND_X11,
};
			
// libweston/compositor.c
static const char * const backend_map[] = {
	[WESTON_BACKEND_DRM] =		&#34;drm-backend.so&#34;,
	[WESTON_BACKEND_FBDEV] =	&#34;fbdev-backend.so&#34;,
	[WESTON_BACKEND_HEADLESS] =	&#34;headless-backend.so&#34;,
	[WESTON_BACKEND_RDP] =		&#34;rdp-backend.so&#34;,
	[WESTON_BACKEND_WAYLAND] =	&#34;wayland-backend.so&#34;,
	[WESTON_BACKEND_X11] =		&#34;x11-backend.so&#34;,
};
</code></pre><p><code>weston_load_module()</code> loads the library located in ‚Äúname‚Äù, the first string received as an argument, with the function <code>dlopen()</code>. The second string received as an argument, ‚Äúentrypoint‚Äù, means the name of a function to be called in the loaded library. In other words, using <code>dlsym</code>, find the address of ‚Äúentrypoint‚Äù, that is, the function <code>weston_backend_init()</code>, and call it. <code>libdl</code> helps you to load the library at runtime and access the symbols of the library. The call stack until reaching <code>weston_load_module()</code> is as follows.</p><ul><li>libweston/compositor.c : weston_load_module(WL_EXPORT) - libweston/compositor.c : weston_compositor_load_backend(WL_EXPORT) - compositor/main.c : weston_compositor_load_backend() - compositor/main.c : load_backend() - compositor/main.c : main()</li></ul></div><div class="post-entry toc" style=margin-bottom:0><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://evening-code.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><link rel=stylesheet href=https://unpkg.com/swiper/swiper-bundle.min.css><style>.swiper{width:100%;height:200%}.swiper-slide{text-align:center;font-size:18px;width:30%;height:200%;display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center}@media screen and (max-width:576px){.swiper-slide{width:70%}}.swiper-slide{opacity:.5;pointer-events:none;transition:all .3s}.swiper-slide-active,.swiper-slide-prev,.swiper-slide-next{opacity:1;pointer-events:auto}.swiper-slide img{display:block;width:100%;height:100%;object-fit:cover;margin:auto}.icon{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor}.news-slider__ctr{width:100%;z-index:12;margin:0;position:absolute;top:50%;-ms-transform:translateY(-50%);transform:translateY(-50%)}.news-slider__arrow{background:currentColor;opacity:.5;border:none;display:inline-flex;width:50px;height:50px;justify-content:center;align-items:center;border-radius:50%;position:absolute;top:50%;z-index:12;cursor:pointer;outline:none!important}.news-slider__arrow:focus{outline:none!important}.news-slider__arrow .icon-font{display:inline-flex}.news-slider__arrow.news-slider-prev{left:15px;transform:translateY(-50%)}.news-slider__arrow.news-slider-next{right:15px;transform:translateY(-50%)}.news-slider__pagination{text-align:center;margin-top:50px}.news-slider__pagination .swiper-pagination-bullet{width:13px;height:10px;display:inline-block;background:#fff;opacity:.2;margin:0 5px;border-radius:20px;transition:opacity .5s,background-color .5s,width .5s;transition-delay:.5s,.5s,0s}.news-slider__pagination .swiper-pagination-bullet-active{opacity:1;background:#fff;width:100px;transition-delay:0s}@media screen and (max-width:768px){.news-slider__pagination .swiper-pagination-bullet-active{width:70px}.news-slider__ctr{display:none}}</style><script src=https://unpkg.com/swiper/swiper-bundle.min.js></script>
<script>var swiper=new Swiper(".mySwiper",{effect:"coverflow",loop:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:3,slideShadows:!1},navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})</script><footer class=footer style=margin-bottom:0><article class=post-entry style=transform:scale(1);background-color:var(--code-bg)><span>NEIGHBORS</span><div style=line-height:10px;display:flex;flex-wrap:wrap><a style=border-bottom:0;bottom:unset href=https://beintous.net rel="noopener noreferrer" target=_blank title="SEO "><span><img style=margin-inline-start:14px;border-radius:3px src=https://baek9.github.io/beintous.png alt=SEO aria-label=logo height=30></span></a>
<a style=border-bottom:0;bottom:unset href=https://traceback.co.kr rel="noopener noreferrer" target=_blank title="ÏΩîÎî© "><span><img style=margin-inline-start:14px;border-radius:3px src=https://baek9.github.io/traceback.png alt=ÏΩîÎî© aria-label=logo height=30></span></a>
<a style=border-bottom:0;bottom:unset href=https://neppster.com rel="noopener noreferrer" target=_blank title="ÎÖ∏ÌïòÏö∞ "><span><img style=margin-inline-start:14px;border-radius:3px src=https://baek9.github.io/neppster.png alt=ÎÖ∏ÌïòÏö∞ aria-label=logo height=30></span></a>
<a style=border-bottom:0;bottom:unset href=https://hannuricenter.modoo.at rel="noopener noreferrer" target=_blank title="ÎåÄÍµ¨ Ïñ∏Ïñ¥ÏπòÎ£å "><span><img style=margin-inline-start:14px;border-radius:3px src=https://baek9.github.io/hannuri.jpeg alt="ÎåÄÍµ¨ Ïñ∏Ïñ¥ÏπòÎ£å" aria-label=logo height=30></span></a>
<a style=border-bottom:0;bottom:unset href=https://julesflower.com rel="noopener noreferrer" target=_blank title="Í±∞Ï†ú ÍΩÉÏßë "><span><img style=margin-inline-start:14px;border-radius:3px src=https://baek9.github.io/jules.jpeg alt="Í±∞Ï†ú ÍΩÉÏßë" aria-label=logo height=30></span></a></div></article></footer><footer class=footer><span>&copy; 2022 <a href=https://baek9.github.io/en/>code(evening); Development Diary</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer nofollow" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel="noopener noreferrer nofollow" target=_blank>PaperMod</a></span></footer><style>.sticky_share_btn{position:fixed;right:30px;bottom:30px}.share-toggle,.fixed_share{font-size:20px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px solid;border-radius:50%;transition:all .5s ease-in-out;opacity:.5}.fixed_share{margin-bottom:10px}.share-toggle:hover,.fixed_share:hover{transform:scale(1.1)rotate(360deg)}.fixed_share .facebook,.fixed_share .facebook>a{color:#4267b2}</style><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css><div class=sticky_share_btn><div class=lang-switch role=button id=theme-toggle><div id=sun class=fixed_share style=color:#ff0><i class="fa fa-sun"></i></div><div id=moon class=fixed_share style=color:#000><i id=moon class="fa fa-moon"></i></div></div><div class="lang-switch fixed_share"><a href=https://baek9.github.io/2018/01/%EA%B7%B8%EB%9E%98%ED%94%BD-%EC%B9%B4%EB%93%9C%EC%97%90-%EB%8C%80%EC%9D%91%EB%90%98%EB%8A%94-drm-%EB%94%94%EB%B0%94%EC%9D%B4%EC%8A%A4-%EB%85%B8%EB%93%9C-%EC%B0%BE%EA%B8%B0/>üá∞üá∑</a></div><div class="lang-switch fixed_share"><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=top-link accesskey=g><i class="fa-solid fa-arrow-up"></i></a></div></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"));const e=new Event("themeChanged");document.dispatchEvent(e)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script></body></html>